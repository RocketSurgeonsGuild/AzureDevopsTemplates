parameters:
  Artifacts: "$(Pipeline.Workspace)/nuget/"
  MyGetFeed: "myget.org"
  NuGetFeed: "nuget.org"
  GitHubFeed: "github.nuget"
  GitHubPackages: false

steps:
  - ${{ if startsWith(variables['Build.SourceBranch'], 'refs/tags/v') }}:
      - task: DotNetCoreCLI@2
        displayName: Push NuGet packages to ${{ parameters.NuGetFeed }}
        inputs:
          command: push
          nuGetFeedType: external
          packagesToPush: "${{ parameters.Artifacts }}/**/*.nupkg;!${{ parameters.Artifacts }}/**/*.symbols.nupkg"
          publishFeedCredentials: ${{ parameters.NuGetFeed }}
          continueOnError: true

  - ${{ if or(startsWith(variables['Build.SourceBranch'], 'refs/tags/v'), eq(variables['Build.SourceBranch'], 'refs/heads/master')) }}:
      - task: DotNetCoreCLI@2
        displayName: Push NuGet packages to ${{ parameters.MyGetFeed }}
        inputs:
          command: push
          nuGetFeedType: external
          packagesToPush: "${{ parameters.Artifacts }}/**/*.nupkg;!${{ parameters.Artifacts }}/**/*.symbols.nupkg"
          publishFeedCredentials: ${{ parameters.MyGetFeed }}
          continueOnError: true

      - ${{ if eq(parameters.GitHubPackages, 'true') }}:
          - task: DotNetCoreCLI@2
            displayName: Push NuGet packages to ${{ parameters.GitHubFeed }}
            inputs:
              command: push
              nuGetFeedType: external
              packagesToPush: "${{ parameters.Artifacts }}/**/*.nupkg;!${{ parameters.Artifacts }}/**/*.symbols.nupkg"
              publishFeedCredentials: ${{ parameters.GitHubFeed }}
              continueOnError: true
