parameters:
  Artifacts: $(Build.ArtifactStagingDirectory)
  FeedId: ''
  FeedUri: ''
  Verbosity: 'Normal'
  AllowPackageConflicts: 'true'
  AccessToken: '$(System.AccessToken)'

steps:
  - task: NuGetCommand@2
    displayName: NuGet Push
    inputs:
      command: "push"
      packagesToPush: ${{ format('{0}/nuget/*.nupkg;!{0}/nuget/*.symbols.nupkg', parameters.Artifacts) }}
      feedPublish: ${{ parameters.FeedId }}
      verbosityPush: ${{ parameters.Verbosity }}
      allowPackageConflicts: ${{ parameters.AllowPackageConflicts }}
    env:
      NUGET_CREDENTIALPROVIDER_SESSIONTOKENCACHE_ENABLED: 'true'
      VSS_NUGET_EXTERNAL_FEED_ENDPOINTS: ${{ format('{"endpointCredentials": [{"endpoint":"{1}", "password":"{0}"}]}', parameters.AccessToken, parameters.FeedUri) }}
