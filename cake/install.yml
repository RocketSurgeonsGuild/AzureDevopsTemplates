parameters:
  DotNetSdk:
    - "2.2.x"
    - "3.0.x"
  NuGetVersion: "5.3.0"
  NuGetPackages: $(Pipeline.Workspace)/.nuget/packages
  RestorePackageConfig: false

steps:
  # - task: CacheBeta@0
  #   inputs:
  #     key: '$(Agent.OS) | nuget | NuGet.config'
  #     path: ${{ parameters.NuGetPackages }}
  #   displayName: Cache NuGet packages

  - ${{ each sdk in parameters.DotNetSdk }}:
      - task: UseDotNet@2
        displayName: Install dotnet ${{ sdk }}
        inputs:
          packageType: "sdk"
          version: ${{ sdk }}

  - ${{ each feed in parameters.AuthNuGetFeeds }}:
    - task: NuGetCommand@2
      inputs:
        command: 'custom'
        arguments: 'sources update -Name "${{ feed.name }}" -UserName "${{ feed.username }}" -Password "${{ feed.password }}"'
      displayName: Authorize NuGet ${{ feed.name }}

  - task: DotNetCoreCLI@2
    displayName: "dotnet tool restore"
    inputs:
      command: custom
      custom: tool
      arguments: "restore"

  - ${{ if eq(parameters.RestorePackageConfig, true) }}:
      - task: NuGetToolInstaller@1
        displayName: "Get NuGet"
        inputs:
          versionSpec: ${{ parameters.NuGetVersion }}
      - task: NuGetCommand@2
        displayName: "Cake restore packages.config"
        inputs:
          command: custom
          feedsToUse: config
          arguments: install tools/packages.config -ExcludeVersion -OutputDirectory tools
